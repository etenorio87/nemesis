# üó∫Ô∏è Nemesis Trading Bot - Roadmap de Desarrollo

## Estado Actual: MVP Completado ‚úÖ

- [x] Integraci√≥n con Binance API (Testnet y Mainnet)
- [x] An√°lisis t√©cnico con indicadores (RSI, MACD, SMA, EMA)
- [x] Sistema de se√±ales BUY/SELL/HOLD con niveles de confianza
- [x] Backtesting completo con m√©tricas avanzadas
- [x] Stop-loss (fijo y trailing)
- [x] Take-profit configurable
- [x] DTOs y validaci√≥n con class-validator
- [x] Arquitectura de monorepo con Nx
- [x] API REST con NestJS

---

## üìã Pr√≥ximos Pasos

### 0. **Indicadores Configurables** üéØ *[PR√ìXIMO]*

**Objetivo:** Permitir configurar los par√°metros de los indicadores t√©cnicos desde el request.

**Tareas:**
- [ ] Crear tipos/interfaces para configuraci√≥n de indicadores en `nemesis-commons`
  - `IndicatorSettings` con opciones para RSI, MACD, SMA, EMA
  - Valores por defecto claramente definidos
- [ ] Actualizar DTOs (`AnalyzeSymbolDto`, `RunBacktestDto`) para aceptar `indicatorSettings` opcional
- [ ] Modificar `AnalysisService.analyzeTechnicals()` para recibir y usar configuraci√≥n personalizada
- [ ] Agregar validaci√≥n de rangos para los par√°metros (ej: RSI period entre 5-50)
- [ ] Documentar par√°metros recomendados para cada indicador
- [ ] Probar diferentes combinaciones de par√°metros

**Resultado esperado:**
```json
{
  "symbol": "BTCUSDT",
  "interval": "1h",
  "indicatorSettings": {
    "rsi": { "period": 10 },
    "macd": { "fastPeriod": 8, "slowPeriod": 21, "signalPeriod": 5 },
    "sma": { "period": 50 },
    "ema": { "period": 21 }
  }
}
```

---

### 0.5. **Detector de Tendencias del Mercado** üìä *[DESPU√âS DE FASE 0]*

**Objetivo:** Detectar autom√°ticamente la tendencia del mercado y adaptar la estrategia de trading.

**Flujo de ejecuci√≥n:**
```
1. Usuario env√≠a request ‚Üí con/sin par√°metros de indicadores
2. Sistema obtiene klines hist√≥ricos
3. ‚≠ê Analizar tendencia del mercado (BULLISH/BEARISH/SIDEWAYS)
4. Calcular indicadores seg√∫n tendencia y par√°metros del usuario
5. Procesar klines buscando se√±ales BUY/SELL/HOLD
6. Aplicar filtros de tendencia:
   - BEARISH ‚Üí No operar (forzar HOLD)
   - SIDEWAYS ‚Üí Mean reversion strategy
   - BULLISH ‚Üí Trend following strategy
7. Ejecutar trade (backtest/paper/live seg√∫n modo)
```

**Tareas:**
- [ ] Crear `TrendAnalysisService` independiente
- [ ] Implementar indicadores para detectar tendencia:
  - ADX (Average Directional Index) para fuerza de tendencia
  - EMA m√∫ltiples (20, 50, 200) para direcci√≥n
  - Price Action analysis
  - Slope de las medias m√≥viles
- [ ] Crear tipo `MarketTrend` en `nemesis-commons`:
  ```typescript
  interface MarketTrend {
    type: 'BULLISH' | 'BEARISH' | 'SIDEWAYS';
    strength: number; // 0-100 (fuerza de la tendencia)
    confidence: number; // 0-100 (confianza en la detecci√≥n)
    reason: string;
    indicators: {
      adx?: number;
      emaSlope?: number;
      pricePosition?: string;
    };
  }
  ```
- [ ] Crear estrategias adaptativas por tendencia:
  - `TREND_FOLLOWING` (para mercados alcistas)
  - `MEAN_REVERSION` (para mercados laterales)
  - Pesos diferentes de indicadores seg√∫n estrategia
- [ ] Modificar `AnalysisService.generateSignal()` para recibir tendencia
- [ ] Implementar filtro de mercado bajista (no operar)
- [ ] Ajustar SL/TP seg√∫n tipo de mercado:
  - Lateral: SL m√°s ajustado (1.5%), TP conservador (3%)
  - Alcista: SL normal, TP m√°s amplio
- [ ] Actualizar `TradeSignal` para incluir:
  ```typescript
  interface TradeSignal {
    // ... campos existentes
    marketTrend: MarketTrend;
    strategyUsed: string; // 'TREND_FOLLOWING' | 'MEAN_REVERSION'
    indicatorsConfig: IndicatorSettings;
  }
  ```
- [ ] Agregar endpoint `/trading/analyze-trend` para solo ver tendencia
- [ ] Tests de detecci√≥n de tendencias con datos hist√≥ricos
- [ ] Documentar umbrales y par√°metros de detecci√≥n

**Resultado esperado:**
```json
{
  "signal": "BUY",
  "confidence": 75,
  "marketTrend": {
    "type": "BULLISH",
    "strength": 85,
    "confidence": 90,
    "reason": "ADX alto (35), EMAs alineadas alcistas, precio sobre EMA200"
  },
  "strategyUsed": "TREND_FOLLOWING",
  "indicatorsConfig": { ... }
}
```

**Consideraciones importantes:**
- En mercado SIDEWAYS: Mayor riesgo de se√±ales falsas (whipsaws)
- En mercado BEARISH: No operar (por ahora, en futuro agregar shorts)
- Logging detallado de decisiones para an√°lisis posterior
- Permitir override manual del filtro de tendencia (par√°metro opcional)

---

### 1. **Optimizaci√≥n Autom√°tica de Par√°metros** üîß

**Objetivo:** Encontrar autom√°ticamente los mejores par√°metros para cada s√≠mbolo y timeframe.

**Tareas:**
- [ ] Implementar Grid Search para optimizar:
  - Periodos de indicadores (RSI, MACD, SMA, EMA)
  - Niveles de Stop-loss y Take-profit
  - Umbrales de confianza para se√±ales
- [ ] Crear servicio `OptimizationService` que:
  - Ejecute m√∫ltiples backtests con diferentes combinaciones
  - Eval√∫e seg√∫n m√©tricas: Profit Factor, Sharpe Ratio, Max Drawdown
  - Identifique la mejor configuraci√≥n
- [ ] Endpoint `/optimization/find-best-params`
- [ ] Guardar resultados de optimizaciones para consulta posterior
- [ ] Implementar Walk-Forward Analysis para validar resultados
- [ ] Agregar l√≠mites de tiempo/iteraciones para evitar procesos infinitos

**M√©tricas de evaluaci√≥n:**
- Sharpe Ratio (retorno ajustado por riesgo)
- Profit Factor (ganancias/p√©rdidas)
- Win Rate
- Max Drawdown
- Total Return

---

### 2. **M√°s Estrategias de Trading** üìä

**Objetivo:** Ampliar el arsenal de indicadores y estrategias.

**Fase 2.1: Nuevos Indicadores**
- [ ] Bollinger Bands (bandas de volatilidad)
- [ ] Stochastic RSI (momentum)
- [ ] ATR - Average True Range (volatilidad)
- [ ] ADX - Average Directional Index (fuerza de tendencia)
- [ ] Ichimoku Cloud (an√°lisis completo)
- [ ] Volume indicators (OBV, Volume Profile)

**Fase 2.2: Estrategias Compuestas**
- [ ] Estrategia de Mean Reversion (reversi√≥n a la media)
- [ ] Estrategia de Breakout (ruptura de niveles)
- [ ] Estrategia de Tendencia (seguimiento de tendencias)
- [ ] Estrategia Multi-timeframe (an√°lisis en varios intervalos)
- [ ] Permitir crear estrategias personalizadas combinando indicadores

**Fase 2.3: Sistema de Estrategias**
- [ ] `StrategyService` para gestionar m√∫ltiples estrategias
- [ ] Interfaz com√∫n para todas las estrategias
- [ ] Comparador de estrategias (backtesting paralelo)
- [ ] Selector autom√°tico de mejor estrategia por s√≠mbolo

---

### 3. **Trading Real (Paper Trading primero)** üí∞

**Objetivo:** Ejecutar trades reales basados en las se√±ales del bot.

**Fase 3.1: Paper Trading**
- [ ] Modo simulaci√≥n sin dinero real
- [ ] Sistema de √≥rdenes simuladas
- [ ] Monitoreo en tiempo real del mercado
- [ ] Registro detallado de todas las operaciones simuladas
- [ ] Dashboard de rendimiento en vivo

**Fase 3.2: Trading Real**
- [ ] Sistema de gesti√≥n de √≥rdenes con Binance:
  - Market orders
  - Limit orders
  - Stop-loss orders
  - Take-profit orders
  - OCO (One-Cancels-Other) orders
- [ ] Gesti√≥n de riesgo:
  - L√≠mite de capital por trade
  - L√≠mite de p√©rdida diaria
  - L√≠mite de trades simult√°neos
  - Tama√±o de posici√≥n din√°mico
- [ ] Sistema de confirmaci√≥n para trades (requerir aprobaci√≥n manual)
- [ ] Modo autom√°tico vs semi-autom√°tico
- [ ] Circuit breakers (pausar bot ante p√©rdidas excesivas)

**Fase 3.3: Monitoreo Continuo**
- [ ] WebSocket para datos de mercado en tiempo real
- [ ] Sistema de eventos para se√±ales de trading
- [ ] Health checks y reconexi√≥n autom√°tica
- [ ] Manejo de errores de API (rate limits, timeouts)

---

### 4. **Sistema de Notificaciones** üì±

**Objetivo:** Alertar al usuario sobre eventos importantes.

**Fase 4.1: Telegram Bot**
- [ ] Crear bot de Telegram
- [ ] Notificaciones de:
  - Se√±ales generadas (BUY/SELL)
  - Trades ejecutados
  - Stop-loss / Take-profit activados
  - Errores cr√≠ticos
  - Resumen diario de performance
- [ ] Comandos del bot:
  - `/status` - Estado actual del bot
  - `/balance` - Balance de cuenta
  - `/trades` - √öltimos trades
  - `/pause` / `/resume` - Control del bot
  - `/stats` - Estad√≠sticas

**Fase 4.2: Email Notifications**
- [ ] Integraci√≥n con servicio de email (SendGrid/Mailgun)
- [ ] Reportes diarios/semanales por email
- [ ] Alertas de eventos cr√≠ticos
- [ ] Templates HTML profesionales

**Fase 4.3: Webhooks**
- [ ] Sistema de webhooks configurables
- [ ] Integraci√≥n con servicios externos (Discord, Slack)
- [ ] Formato de payload estandarizado

---

### 5. **Base de Datos y Persistencia** üíæ

**Objetivo:** Almacenar historial y configuraciones de forma persistente.

**Fase 5.1: Setup de Infraestructura**
- [ ] Docker Compose con Redis y MariaDB
- [ ] Configuraci√≥n de conexiones en NestJS
- [ ] Migraciones de base de datos con TypeORM

**Fase 5.2: Modelos de Datos**
- [ ] Entidad `Trade` (historial de operaciones)
- [ ] Entidad `Signal` (se√±ales generadas)
- [ ] Entidad `BacktestResult` (resultados de backtests)
- [ ] Entidad `BotConfiguration` (configuraciones guardadas)
- [ ] Entidad `PerformanceMetric` (m√©tricas diarias)

**Fase 5.3: Repositorios y Servicios**
- [ ] Repository pattern para cada entidad
- [ ] Servicio de persistencia de trades
- [ ] Servicio de historial de se√±ales
- [ ] Cache con Redis para datos de mercado
- [ ] Queries optimizadas para reportes

**Fase 5.4: Features con DB**
- [ ] Historial completo de operaciones
- [ ] An√°lisis de performance hist√≥rica
- [ ] Comparaci√≥n de periodos
- [ ] Exportaci√≥n de datos (CSV, Excel)

---

### 6. **Dashboard y Visualizaci√≥n** üìà

**Objetivo:** Interface para monitorear y controlar el bot.

**Fase 6.1: API de Estad√≠sticas**
- [ ] Endpoints para m√©tricas en tiempo real
- [ ] Endpoints de historial (trades, se√±ales, equity)
- [ ] Endpoints de configuraci√≥n (CRUD de strategies)
- [ ] WebSocket para updates en vivo

**Fase 6.2: Dashboard Web (opcional - antes de app m√≥vil)**
- [ ] Dashboard b√°sico con Angular (reusando nemesis-app)
- [ ] Gr√°ficos de equity curve
- [ ] Lista de trades activos
- [ ] Controles de bot (start/stop/pause)
- [ ] Formularios de configuraci√≥n

**Fase 6.3: App M√≥vil (Ionic/Angular)**
- [ ] Desarrollo de nemesis-app
- [ ] Pantallas principales:
  - Dashboard de resumen
  - Historial de trades
  - Configuraci√≥n de estrategias
  - Notificaciones
  - Controles del bot
- [ ] Autenticaci√≥n y seguridad
- [ ] Build para iOS y Android

---

### 7. **Preparaci√≥n para Producci√≥n** üöÄ

**Objetivo:** C√≥digo robusto, seguro y escalable.

**Fase 7.1: Logging y Monitoreo**
- [ ] Winston para logging estructurado
- [ ] Niveles de log apropiados (error, warn, info, debug)
- [ ] Rotaci√≥n de logs
- [ ] Integraci√≥n con servicios de monitoreo (Datadog, Sentry)
- [ ] M√©tricas de aplicaci√≥n (Prometheus)

**Fase 7.2: Manejo de Errores**
- [ ] Global exception filters
- [ ] Retry logic para llamadas a Binance API
- [ ] Fallback strategies ante fallos
- [ ] Alertas autom√°ticas de errores cr√≠ticos
- [ ] Circuit breaker pattern

**Fase 7.3: Seguridad**
- [ ] Autenticaci√≥n JWT para endpoints
- [ ] Rate limiting por IP/usuario
- [ ] Encriptaci√≥n de API keys
- [ ] Validaci√≥n exhaustiva de inputs
- [ ] CORS configurado correctamente
- [ ] Secrets management (variables de entorno seguras)

**Fase 7.4: Tests**
- [ ] Tests unitarios de servicios cr√≠ticos
- [ ] Tests de integraci√≥n con Binance (usando testnet)
- [ ] Tests de backtesting con datos sint√©ticos
- [ ] Tests E2E de flujos completos
- [ ] Cobertura de c√≥digo >80%
- [ ] CI/CD con GitHub Actions

**Fase 7.5: Documentaci√≥n**
- [ ] API documentation con Swagger/OpenAPI
- [ ] Gu√≠as de deployment
- [ ] Gu√≠as de troubleshooting
- [ ] Documentaci√≥n de estrategias
- [ ] Ejemplos de uso completos

**Fase 7.6: Performance**
- [ ] Profiling y optimizaci√≥n de queries
- [ ] Caching estrat√©gico
- [ ] Connection pooling para DB
- [ ] Compresi√≥n de responses
- [ ] Rate limiting interno para Binance

**Fase 7.7: Deployment**
- [ ] Dockerizaci√≥n completa
- [ ] Docker Compose para entorno completo
- [ ] Scripts de deployment
- [ ] Configuraci√≥n para VPS/Cloud (AWS, DigitalOcean)
- [ ] Backups autom√°ticos de DB
- [ ] Rollback strategy

---

## üéØ Criterios de √âxito por Fase

### Fase 0 - Indicadores Configurables
‚úÖ Poder ejecutar backtests con diferentes configuraciones de indicadores  
‚úÖ Documentaci√≥n clara de par√°metros recomendados  
‚úÖ Validaci√≥n robusta de inputs

### Fase 0.5 - Detector de Tendencias
‚úÖ Detectar tendencia correctamente en >85% de casos hist√≥ricos  
‚úÖ No operar en mercados bajistas (0 trades en BEARISH)  
‚úÖ Adaptar estrategia autom√°ticamente seg√∫n tendencia  
‚úÖ Logging claro de tendencia detectada en cada an√°lisis

### Fase 1 - Optimizaci√≥n
‚úÖ Encontrar configuraci√≥n √≥ptima en <5 minutos  
‚úÖ Mejora medible en Profit Factor  
‚úÖ Resultados reproducibles

### Fase 2 - Estrategias
‚úÖ Al menos 5 estrategias diferentes implementadas  
‚úÖ Comparaci√≥n clara entre estrategias  
‚úÖ Sistema extensible para agregar m√°s

### Fase 3 - Trading Real
‚úÖ Paper trading funcionando 24/7 sin errores  
‚úÖ 0 trades no intencionados en modo real  
‚úÖ Circuit breakers funcionando correctamente

### Fase 4 - Notificaciones
‚úÖ Recibir alertas en <5 segundos del evento  
‚úÖ 0 notificaciones perdidas  
‚úÖ Formato claro y accionable

### Fase 5 - Base de Datos
‚úÖ Queries de historial <500ms  
‚úÖ 100% de trades persistidos  
‚úÖ Backups autom√°ticos funcionando

### Fase 6 - Dashboard
‚úÖ Interface responsive y r√°pida  
‚úÖ Updates en tiempo real sin lag  
‚úÖ Usable en m√≥vil

### Fase 7 - Producci√≥n
‚úÖ Uptime >99%  
‚úÖ Cobertura de tests >80%  
‚úÖ 0 secrets en c√≥digo  
‚úÖ Logs estructurados y analizables  
‚úÖ Recovery autom√°tico de errores comunes

---

## üìÖ Estimaci√≥n de Tiempo

| Fase | Complejidad | Tiempo Estimado |
|------|-------------|-----------------|
| 0. Indicadores Configurables | Baja | 2-3 d√≠as |
| 0.5. Detector de Tendencias | Media | 4-6 d√≠as |
| 1. Optimizaci√≥n Autom√°tica | Media | 5-7 d√≠as |
| 2. M√°s Estrategias | Media-Alta | 10-14 d√≠as |
| 3. Trading Real | Alta | 14-21 d√≠as |
| 4. Notificaciones | Baja | 3-5 d√≠as |
| 5. Base de Datos | Media | 7-10 d√≠as |
| 6. Dashboard | Media-Alta | 14-21 d√≠as |
| 7. Producci√≥n | Media | 10-14 d√≠as |

**Total estimado:** 2.5-3.5 meses trabajando consistentemente

---

## üéì Aprendizajes Esperados

- Arquitectura de trading bots robustos
- An√°lisis t√©cnico avanzado
- Optimizaci√≥n algor√≠tmica
- Gesti√≥n de riesgo
- APIs financieras en producci√≥n
- Monitoreo y observabilidad
- Testing de sistemas cr√≠ticos

---

## ‚ö†Ô∏è Riesgos y Consideraciones

1. **Overfitting en optimizaci√≥n:** Los par√°metros √≥ptimos en backtest pueden no funcionar en forward testing
2. **Cambios de mercado:** Las estrategias deben adaptarse a diferentes condiciones
3. **L√≠mites de API:** Respetar rate limits de Binance
4. **Slippage:** Diferencia entre precio esperado y ejecutado
5. **Latencia:** El tiempo importa en trading
6. **Costos de comisiones:** Pueden eliminar rentabilidad en estrategias de alta frecuencia

---

## üìö Recursos √ötiles

- [Binance API Documentation](https://binance-docs.github.io/apidocs/)
- [Technical Indicators Library](https://github.com/anandanand84/technicalindicators)
- [NestJS Documentation](https://docs.nestjs.com/)
- [Nx Monorepo Guide](https://nx.dev/)
- [Trading Strategy Design Patterns](https://www.investopedia.com/articles/active-trading/11/four-types-of-active-traders.asp)

---

**Documento vivo - Se actualizar√° conforme avancemos** üöÄ
